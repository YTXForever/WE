# CPU使用率

## 概念
    1.什么是cpu使用率
    cpu在被操作操作系统调度的时候，cpu的时钟周期会被划分为一段段的时间片，每段时间片称为一个节拍，一个节拍具体有多长和进程的状态有关，进程在用户态的时候每个节拍固定是1/100s,内核态的节拍则是可以配置的。
    cpu的使用率 = 1 -（一段时间内cpu空闲的时间/一段时间）
    以top为例 这段时间就是3s

    2.名词解释
    us 用户态cpu  不包括nice 但是包括guest
    sys 内核态cpu 
    nice/ni 低优先级用户态cpu 也就是nice值被被调整为1-19的的cpu 取值范围 -20-19 数值越大 优先级越低
    idle 代表cpu空闲状态
    iowait cpu等待I/O的时间
    irq/hi 硬中断 是硬件发出的中断 比如键盘 网卡 通知内核读取
    softirq / si 软中断 是正在执行的进程发出的中断信号 大部分是告诉内核为其进行I/O操作
## 问题
    1.cpu使用率过高到底怎么办
    top一下 看哪个进程占的多 如果是java进程 直接一套jstack带走
    也可以pidstat -u 看一下进程sys和us，大部分是us出现的问题 就需要在自己的代码中找问题
    如果不是java进程 使用perf top 定位一下cpu使用率很高的函数   
    2.cpu使用率很高 但是看不到哪个进程高 如何处理
    这个时候top一下 或者vmstat一下 看一下running的进程多不多 看一下running的进程具体是哪些 然后pstree 看一下这些进程的父进程是啥 很大概率是这些进程频繁启动停止导致的cpu使用率过高的问题

    perf record -p [pid] 记录采样情况 perf report 用来显示刚才的采样 可以显示出占用cpu时钟周期的函数名 

    出现这种问题的原因大概有两种
    1.程序内调用了其他二进制程序 速度很快
    2.某个程序频繁崩溃重启
    

   