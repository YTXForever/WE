# Context Switch

## 概念
        1.什么是cpu上下文切换
        cpu的上下文切换清空或者恢复了cpu的寄存器和pc(Program Counter 程序计数器，记录当前进程执行到了哪行指令)的数据，因为cpu执行的数据都要先进入寄存器，执行的程序不同时，数据自然不同，当一个进程交出执行权的时候，会保存寄存器和pc的数据，当重新被系统调度的时候，这些数据再恢复到寄存器和pc之中，这个过程就叫cpu上下文切换。

        2.什么情况下会发生cpu上下文切换
            1）cpu的时间片到期，进程被迫交出执行权
            2）系统资源不足时，进程主动让出执行权
            3）当有优先级高的进程时，系统会优先调度
            4）中断程序一般优先级比较高，中断程序一般伴随着上下文切换
    
        3.进程上下文切换和线程上下文切换的区别
        进程上下文切换涉及到虚拟内存的切换，而线程择不涉及，因为是同一个进程共享资源，只涉及到寄存器和pc，所以一般趋向于使用多线程

        4.什么是特权模式
        当进程执行内核态操作时，进程会转为内核态，执行内核操作，比如文件io，这个时候也会发生cpu上下文切换

## 问题
    1.如何定位上下文切换问题
        1）vmstat 输出cs情况 ，如果异常的高（>1w），就需要排查
        2）看就绪队列r的长度，如果很多那就是因为进程太多，或者线程太多，此时利用pidstat -wt 定位问题进程
    2.如何定位中断次数过多的问题
         1）vmstat 输出in情况 ，如果异常的高，就需要排查
         2）cat /proc/interrupts 一般RES比较高 这是系统在cpu进行空闲重调度，需要给cpu发出中断指令