# Linux内存基础

## 我们说的内存是什么
    我们所说的内存全都是DRAM(随机访问内存)，也就是物理内存。

## 物理内存和虚拟内存的联系
    进程是不能直接访问物理内存的，只有内核才可以直接访问物理内存。所以进程只能访问虚拟内存，虚拟内存和物理内存对应用的是页表映射，页表上会标明，这块虚拟内存指向的物理内存有哪些。并不是所有的虚拟内存都有物理内存对应，虚拟内存是在第一次使用的时候发现没有物理内存对应发生缺页异常才会对应上物理内存，页表保存在cpu内存管理单元MMU中，TLB是MMU的高速缓存。

## 虚拟内存出现的意义是什么
    虚拟内存的意义就是按需使用内存，比如说一个进程申请4G内存但是只使用一个1G，那么就只对应1个G的物理内存。

## 内存回收的机制
    1.LRU机制，系统会释放掉最近没有被使用掉的缓存
    2.Swap机制，系统会把很久未使用到的内存交换到磁盘中的swap分区中，写入磁盘叫做换入，恢复到内存叫做换出，swap通常会发生严重的性能问题。

## 上下文切换对于TLB的影响
    CPU发生上下文切换时会刷新TLB的内存，而MMU的访问速度又比TLB慢

## top的用法
     VIRT:进程使用的虚拟内存的大小  
     RES:进程使用的物理内存的大小 
     SHR:进程使用的共享内存的大小
     %MEM:进程使用物理内存的大小占用实际物理内存大小的比值

## free的用法             
    total       used       free     shared    buffers     cached
    Mem:      16466956   16251700     215256        468     407532     683852
    -/+ buffers/cache:   15160316    1306640
    Swap:            0          0          0

    total：总物理内存
    free：空闲物理内存
    shared:被进程共享的物理内存
    buffers：对于磁盘读写的缓存
    cache对于文件读写的缓存
    -/+ buffers/cache: 实际使用的内存和实际空余的内存 used-buffers-cache/free+buffer+cache
    used包括buffer和cache free不包括buffer和cache

    vmstat可以查看 buffer 和 cache 情况


